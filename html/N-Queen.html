<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>N皇后回溯法动态演示</title>
    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; display: flex; flex-direction: column; align-items: center; background-color: #f0f2f5; }
        .controls { margin: 20px; padding: 15px; background: white; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        .board { display: grid; border: 4px solid #34495e; box-shadow: 0 5px 15px rgba(0,0,0,0.3); }
        .cell { width: 60px; height: 60px; display: flex; justify-content: center; align-items: center; font-size: 35px; transition: all 0.3s; }
        .white { background-color: #ecf0f1; }
        .black { background-color: #bdc3c7; }
        .queen { animation: pop 0.3s ease; }
        .conflict { background-color: #e74c3c !important; color: white; }
        .current-row { border: 2px solid #3498db; }
        @keyframes pop { 0% { transform: scale(0); } 100% { transform: scale(1); } }
        #status { margin-top: 10px; font-weight: bold; color: #2c3e50; }
    </style>
</head>
<body>

    <h2>N皇后问题回溯法动态演示</h2>

    <div class="controls">
        <label>皇后数量 (N): </label>
        <input type="number" id="nInput" value="4" min="4" max="10" style="width: 50px;">
        <label>速度 (ms): </label>
        <input type="number" id="speedInput" value="500" min="50" step="50" style="width: 60px;">
        <button onclick="startSolving()">开始演示</button>
        <button onclick="location.reload()">重置</button>
    </div>

    <div id="status">准备就绪</div>
    <div id="board" class="board"></div>

    <script>
        let N;
        let speed;
        let board = [];

        function createBoard() {
            const boardElement = document.getElementById('board');
            boardElement.innerHTML = '';
            boardElement.style.gridTemplateColumns = `repeat(${N}, 60px)`;
            
            for (let i = 0; i < N; i++) {
                for (let j = 0; j < N; j++) {
                    const cell = document.createElement('div');
                    cell.className = `cell ${(i + j) % 2 === 0 ? 'white' : 'black'}`;
                    cell.id = `cell-${i}-${j}`;
                    boardElement.appendChild(cell);
                }
            }
        }

        async function sleep(ms) {
            return new Promise(resolve => setTimeout(resolve, ms));
        }

        async function solve() {
            const queens = new Array(N).fill(-1); // queens[row] = col
            if (await backtrack(queens, 0)) {
                document.getElementById('status').innerText = "找到解了！";
            } else {
                document.getElementById('status').innerText = "当前设置下无解（或已遍历完毕）";
            }
        }

        async function backtrack(queens, row) {
            if (row === N) return true; // 所有行都放好了

            document.getElementById('status').innerText = `正在尝试放置第 ${row + 1} 个皇后...`;

            for (let col = 0; col < N; col++) {
                // 1. 尝试放置
                queens[row] = col;
                const cell = document.getElementById(`cell-${row}-${col}`);
                cell.innerText = '♛';
                cell.style.color = '#2980b9';
                
                await sleep(speed);

                // 2. 测试约束
                if (isValid(queens, row, col)) {
                    cell.style.color = '#27ae60'; // 合法，变绿
                    if (await backtrack(queens, row + 1)) return true;
                } else {
                    cell.classList.add('conflict');
                    await sleep(speed);
                    cell.classList.remove('conflict');
                }

                // 3. 回溯（撤销尝试）
                cell.innerText = '';
                queens[row] = -1;
            }
            return false;
        }

        function isValid(queens, row, col) {
            for (let i = 0; i < row; i++) {
                let prevCol = queens[i];
                // 检查同列
                if (prevCol === col) return false;
                // 检查对角线 (行差 == 列差)
                if (Math.abs(row - i) === Math.abs(col - prevCol)) return false;
            }
            return true;
        }

        function startSolving() {
            N = parseInt(document.getElementById('nInput').value);
            speed = parseInt(document.getElementById('speedInput').value);
            createBoard();
            solve();
        }

        // 初始化
        createBoard();
    </script>
</body>
</html>